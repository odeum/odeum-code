@builtin "whitespace.ne"

@{%
  class Atom {
    constructor(name) { this.name = name; }
    toJSON(){ return this.name; }
  }
  class Juxt {
    constructor(left, right) { this.left = left; this.right = right; }
    toJSON(){ return [this.left.toJSON(), this.right.toJSON()]; }
  }
%}

MAIN -> _ TUPLE _ {% d => d[1] %}

TUPLE -> "(" _ PAIR_RIGHT _ ")" {% d => d[2] %}

PAIR_RIGHT ->
  PAIR_LEFT _ "," _ PAIR_RIGHT {% d => new Juxt(d[0], d[4]) %}
| PAIR_LEFT {% d => d[0] %}

PAIR_LEFT ->
  PAIR_LEFT __ PAIR_LEFT {% d => new Juxt(d[0], d[2]) %}
| TUPLE {% d => d[0] %}
| ATOM {% d => d[0] %}

ATOM -> [^\s()\n,]:+ {% d => new Atom(d[0].join('')) %}
